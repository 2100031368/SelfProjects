{% extends 'adminhome.html' %}

 {% block 'body' %}
<script>
    function collectNumberData() {
        const b = [];
        const rows = document.querySelectorAll('tbody.myInput tr');

        rows.forEach((row) => {
            const numberInputs = row.querySelectorAll('input[type="number"]');
            const facultyid = row.querySelector('.facultyid').innerText.trim();

            // Access and Grievance Access
            const access = numberInputs[0].value;
            const graccess = numberInputs[1].value;

            const rowData = {
                facultyid: facultyid,
                access: access,
                graccess: graccess  // Include grievance access
            };
            b.push(rowData);
        });

        // Convert data to JSON and store it in a hidden input
        document.getElementById('hiddenData').value = JSON.stringify(b);
    }
</script>


<h4 align="center" style="font-family: 'Times New Roman', Times, serif; color:green;">{{msg}}</h4>
<h2 align="center" style="font-family: 'Times New Roman', Times, serif;"><b>⬇️ FACULTY LIST AVAILABLE ⬇️</b></h2><br>

<center>
    <input class="form-control" id="myInput" type="text" placeholder="Search ..."><br><br>
    <form id="facultyForm" action="{% url 'agiveaccess1' %}" method="post" onsubmit="collectNumberData()">
        {% csrf_token %}
        <table border="1" style="font-family: 'Times New Roman', Times, serif; margin-left:15px;">
            <thead>
                <tr bgcolor="lightblue">
                    <td><b>Faculty id</b></td>
                    <td><b>Full name</b></td>
                    <td><b>Department</b></td>
                    <td><b>Academic Year Joined</b></td>
                    <td><b>Qualification</b></td>
                    <td><b>Designation</b></td>
                    <td><b>Email</b></td>
                    <td><b>Contact</b></td>
                    <td><b>Sub-Admin Access</b></td>
                    <td><b>Grievance Access</b></td>
                </tr>
            </thead>
            <tbody class="myInput">
                {% for faculty in facultydata %}
                <tr align="center">
                    <td class="facultyid">{{ faculty.facultyid }}</td>
                    <td class="fullname">{{ faculty.fullname }}</td>
                    <td class="department">{{ faculty.department }}</td>
                    <td class="ay">{{ faculty.ay }}</td>
                    <td class="qualification">{{ faculty.qualification }}</td>
                    <td class="designation">{{ faculty.designation }}</td>
                    <td class="email">{{ faculty.email }}</td>
                    <td class="contact">{{ faculty.contact }}</td>
                     <td><input type="number" value="{{faculty.access}}" min="0" max="1"/></td>
                    <td><input type="number" value="{{faculty.graccess}}" min="0" max="1"/></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <input type="hidden" id="hiddenData" name="hiddenData">
        <button type="submit" class="addbutton">Save</button>
    </form>

</center>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const input = document.getElementById("myInput");
    input.addEventListener("input", filterTable);
});

function filterTable() {
    const filter = document.getElementById("myInput").value.toLowerCase();
    const rows = document.querySelectorAll("tbody tr");
    rows.forEach(row => {
        const cells = row.getElementsByTagName("td");
        let display = "none";
        for (let i = 0; i < cells.length; i++) {
            const cellText = cells[i].textContent || cells[i].innerText;
            if (cellText.toLowerCase().indexOf(filter) > -1) {
                display = "";
                break;
            }
        }
        row.style.display = display;
    });
}
</script>


{% endblock %}
